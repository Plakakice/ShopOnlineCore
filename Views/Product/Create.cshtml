@model ShopOnlineCore.Models.Product

@{
    ViewData["Title"] = "Thêm sản phẩm mới";
}

<style>
    .admin-header {
        background: linear-gradient(135deg, #2fdab8 0%, #27b39e 100%);
        color: white;
        padding: 40px 0;
        margin-bottom: 30px;
        border-radius: 0;
    }

    .info-card {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        margin-bottom: 25px;
    }

    .info-card h3 {
        color: #2fdab8;
        font-size: 1.3em;
        font-weight: 700;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }

    .form-group label {
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
    }

    .btn-save {
        background: #27ae60;
        color: white;
        border: none;
        padding: 10px 24px;
        border-radius: 6px;
        font-weight: 600;
        transition: all 0.3s;
    }

    .btn-save:hover {
        background: #219150;
        color: white;
    }

    .btn-cancel {
        background: #95a5a6;
        color: white;
        border: none;
        padding: 10px 24px;
        border-radius: 6px;
        font-weight: 600;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
    }

    .btn-cancel:hover {
        background: #7f8c8d;
        color: white;
    }
    .image-selection-item {
        position: relative;
        cursor: pointer;
        transition: transform 0.2s;
    }

    .image-selection-item:hover {
        transform: scale(1.05);
    }

    .image-selection-item input[type="radio"] {
        position: absolute;
        top: 10px;
        left: 10px;
        transform: scale(1.5);
        z-index: 10;
        cursor: pointer;
    }
    
    .image-selection-item.is-main {
        border: 3px solid #2fdab8;
        border-radius: 6px;
    }
</style>

<div class="admin-header">
    <div class="container-fluid" style="padding: 0 10px;">
        <h2 style="margin: 0; font-size: 2em; font-weight: 700;">✨ Thêm sản phẩm mới</h2>
        <p style="margin: 5px 0 0 0; opacity: 0.95;">Nhập thông tin chi tiết để tạo sản phẩm mới</p>
    </div>
</div>

<div class="container-fluid" style="margin-bottom: 50px; padding: 0 10px;">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="info-card">
                <h3><i class="fa fa-plus-circle"></i> Thông tin sản phẩm</h3>
                <form asp-action="Create" method="post" enctype="multipart/form-data">
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="Name">Tên sản phẩm <span class="text-danger">*</span></label>
                                <input asp-for="Name" class="form-control" required />
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="CategoryId">Danh mục <span class="text-danger">*</span></label>
                                <select asp-for="CategoryId" class="form-control" asp-items="ViewBag.Categories" required>
                                    <option value="">-- Chọn danh mục --</option>
                                </select>
                                <span asp-validation-for="CategoryId" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="Price">Giá (VND) <span class="text-danger">*</span></label>
                                <input asp-for="Price" type="number" step="1000" min="0" class="form-control" required />
                                <span asp-validation-for="Price" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="Stock">Tồn kho <span class="text-danger">*</span></label>
                                <input asp-for="Stock" type="number" min="0" class="form-control" required />
                                <span asp-validation-for="Stock" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label for="Description">Mô tả</label>
                        <textarea asp-for="Description" class="form-control" rows="4"></textarea>
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>

                    <div class="form-group mb-3">
                        <label>Hình ảnh sản phẩm</label>
                        <input type="file" id="files" name="files" multiple class="form-control" accept="image/*" />
                        <small class="text-muted">Chọn nhiều ảnh. Ảnh đầu tiên sẽ được chọn làm ảnh đại diện mặc định.</small>
                    </div>

                    <!-- Preview ảnh trước khi lưu -->
                    <div id="preview" class="d-flex flex-wrap gap-3 mb-4"></div>

                    <div class="form-group text-center">
                        <button type="submit" class="btn btn-save">
                            <i class="fa fa-save"></i> Lưu sản phẩm
                        </button>
                        <a asp-action="Index" class="btn btn-cancel">
                            <i class="fa fa-times"></i> Hủy
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Hiển thị preview ảnh khi chọn
        document.getElementById('files').addEventListener('change', function (event) {
            const preview = document.getElementById('preview');
            preview.innerHTML = ''; // reset ảnh cũ
            const files = event.target.files;

            if (files.length > 0) {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'image-selection-item ' + (i === 0 ? 'is-main' : '');
                        
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.style.height = '120px';
                        img.style.width = '120px';
                        img.style.objectFit = 'cover';
                        img.classList.add('rounded', 'shadow-sm');
                        
                        // Radio button để chọn ảnh chính
                        const radio = document.createElement('input');
                        radio.type = 'radio';
                        radio.name = 'selectedMainImageIndex';
                        radio.value = i;
                        radio.checked = i === 0; // Mặc định chọn ảnh đầu tiên
                        radio.title = 'Đặt làm ảnh chính';
                        
                        // Sự kiện click để highlight
                        radio.addEventListener('change', function() {
                            document.querySelectorAll('.image-selection-item').forEach(item => {
                                item.classList.remove('is-main');
                            });
                            if (this.checked) {
                                wrapper.classList.add('is-main');
                            }
                        });

                        wrapper.appendChild(radio);
                        wrapper.appendChild(img);
                        preview.appendChild(wrapper);
                    };
                    reader.readAsDataURL(file);
                }
            }
        });
    </script>
}
