@model ShopOnlineCore.Models.Product
@{
    ViewData["Title"] = Model.Name;
}

<style>
    /* Style cho khung h√¨nh ·∫£nh s·∫£n ph·∫©m */
    .flexslider .thumb-image {
        width: 100%;
        height: 450px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        background-color: #f8f9fa;
    }

    .flexslider .thumb-image img {
        width: 100%;
        height: 100%;
        object-fit: contain; /* Gi·ªØ t·ª∑ l·ªá ·∫£nh v√† fit v√†o khung */
        object-position: center;
    }

    /* Style cho thumbnail nh·ªè b√™n d∆∞·ªõi */
    .flexslider .flex-control-nav {
        margin-top: 10px;
    }

    .flexslider .flex-control-nav li img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border: 2px solid #ddd;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .flexslider .flex-control-nav li img:hover,
    .flexslider .flex-control-nav li.flex-active img {
        border-color: #ff4081;
        transform: scale(1.05);
    }

    /* ƒê·∫£m b·∫£o container kh√¥ng b·ªã l·ªói layout */
    .flexslider {
        margin: 0;
        background: #fff;
        border: none;
    }

    .flexslider .slides > li {
        display: none;
        -webkit-backface-visibility: hidden;
    }

    .flexslider .slides img {
        width: 100%;
        display: block;
    }

    /* Success Alert */
    .alert-success-custom {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
        padding: 16px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 12px;
        animation: slideDown 0.3s ease;
    }

    .alert-success-custom i {
        font-size: 1.3em;
    }

    @@keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
</style>

<!-- Page Header -->
<div class="page-head_agile_info_w3l">
    <div class="container">
        <h3>Chi ti·∫øt <span>S·∫£n ph·∫©m</span></h3>
        <div class="services-breadcrumb">
            <div class="agile_inner_breadcrumb">
                <ul class="w3_short">
                    <li><a asp-controller="Home" asp-action="Index">Trang ch·ªß</a><i>|</i></li>
                    <li><a asp-action="Index">S·∫£n ph·∫©m</a><i>|</i></li>
                    <li>@Model.Name</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Success Alert -->
@if (ViewBag.SuccessMessage != null)
{
    <div class="container" style="margin-top: 20px;">
        <div class="alert-success-custom">
            <i class="fa fa-check-circle"></i>
            <span>@ViewBag.SuccessMessage</span>
        </div>
    </div>
}

<!-- Single Product Page -->
<div class="banner-bootom-w3-agileits">
    <div class="container">
        <div class="col-md-7 single-right-left">
            <div class="grid images_3_of_2">
                <div class="flexslider">
                    <ul class="slides">
                        @if (Model.ImageGallery != null && Model.ImageGallery.Any())
                        {
                            @foreach (var img in Model.ImageGallery)
                            {
                                <li data-thumb="@Url.Content(img)">
                                    <div class="thumb-image">
                                        <img src="@Url.Content(img)" class="img-responsive" alt="@Model.Name">
                                    </div>
                                </li>
                            }
                        }
                        else
                        {
                            <li data-thumb="@Url.Content(Model.ImageUrl)">
                                <div class="thumb-image">
                                    <img src="@Url.Content(Model.ImageUrl)" class="img-responsive" alt="@Model.Name">
                                </div>
                            </li>
                        }
                    </ul>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>

        <div class="col-md-5 single-right-left simpleCart_shelfItem" style="padding: 0;">
            <!-- Product Title & Rating -->
            <div style="background: #fff; padding: 25px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.08);">
                <h2 style="color: #333; font-size: 1.6em; font-weight: 700; margin: 0 0 15px 0; line-height: 1.4;">@Model.Name</h2>
                
                <!-- Rating & Reviews Row -->
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #efefef;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <span style="color: #ffc000; font-size: 1.1em;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                        <span style="color: #666; font-size: 0.95em; margin-left: 5px;">4.5 (145 ƒë√°nh gi√°)</span>
                    </div>
                    <div id="sold-box" style="border-left: 1px solid #efefef; padding-left: 15px; color: #666; font-size: 0.95em;">
                        ƒê√£ b√°n <strong id="sold-num"></strong>
                    </div>


                </div>

                <!-- Price Section -->
                <div style="margin-bottom: 20px; padding: 20px; background: #fafafa; border-radius: 6px;">
                    <div style="display: flex; align-items: baseline; gap: 10px; margin-bottom: 8px;">
                        <span style="font-size: 2.2em; font-weight: 700; color: #e74c3c;">@Model.Price.ToString("N0")</span>
                        <span style="font-size: 1em; color: #e74c3c; font-weight: 600;">‚Ç´</span>
                        @if (Model.SalePrice.HasValue && Model.SalePrice > Model.Price)
                        {
                            <del style="color: #999; font-size: 1.2em; margin-left: 10px;">@Model.SalePrice.Value.ToString("N0") ‚Ç´</del>
                            <span style="background: #e74c3c; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-left: 10px;">-@Math.Round((1 - Model.Price / Model.SalePrice.Value) * 100)%</span>
                        }
                    </div>
                    <p style="margin: 0; color: #666; font-size: 0.9em;">
                        <i class="fa fa-info-circle"></i> Gi√° v√† khuy·∫øn m√£i c√≥ th·ªÉ thay ƒë·ªïi
                    </p>
                </div>

                <!-- Stock & Category -->
                <div style="display: flex; gap: 20px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #efefef;">
                    <div>
                        <p style="color: #999; font-size: 0.85em; margin: 0 0 5px 0; text-transform: uppercase;">Kho h√†ng</p>
                        @if (Model.IsAvailable)
                        {
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <i class="fa fa-check-circle" style="color: #27ae60; font-size: 1.1em;"></i>
                                <span style="color: #27ae60; font-weight: 600;">C√≤n h√†ng (@Model.Stock s·∫£n ph·∫©m)</span>
                            </div>
                        }
                        else
                        {
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <i class="fa fa-times-circle" style="color: #e74c3c; font-size: 1.1em;"></i>
                                <span style="color: #e74c3c; font-weight: 600;">H·∫øt h√†ng</span>
                            </div>
                        }
                    </div>
                    <div>
                        <p style="color: #999; font-size: 0.85em; margin: 0 0 5px 0; text-transform: uppercase;">Danh m·ª•c</p>
                        <span style="display: inline-block; background: linear-gradient(135deg, #e8f9f6 0%, #d1ede8 100%); color: #2fdab8; padding: 6px 14px; border-radius: 20px; font-weight: 600; font-size: 0.9em;">@Model.Category</span>
                    </div>
                </div>

                <!-- Quantity & Buttons -->
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <p style="color: #999; font-size: 0.85em; margin: 0; text-transform: uppercase; white-space: nowrap;">S·ªë l∆∞·ª£ng</p>
                    <div style="display: flex; align-items: center; border: 1px solid #ddd; border-radius: 6px; overflow: hidden;">
                        <button type="button" onclick="document.getElementById('quantity').value = Math.max(1, parseInt(document.getElementById('quantity').value) - 1)" style="width: 40px; height: 40px; border: none; background: #fff; cursor: pointer; font-size: 1.2em;">‚àí</button>
                        <input type="number" id="quantity" value="1" min="1" max="@Model.Stock" style="width: 60px; height: 40px; border: none; text-align: center; font-size: 1em; font-weight: 600;" />
                        <button type="button" onclick="document.getElementById('quantity').value = Math.min(@Model.Stock, parseInt(document.getElementById('quantity').value) + 1)" style="width: 40px; height: 40px; border: none; background: #fff; cursor: pointer; font-size: 1.2em;">+</button>
                    </div>
                </div>

                <!-- Add to Cart & Buy Now Buttons -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    @if (Model.IsAvailable)
                    {
                        <form asp-controller="Cart" asp-action="Add" asp-route-id="@Model.Id" method="post" style="display: contents;" onsubmit="document.getElementById('hiddenQuantity').value = document.getElementById('quantity').value;">
                            <input type="hidden" name="quantity" id="hiddenQuantity" value="1" />
                            <button type="submit" style="padding: 14px 20px; background: #fff; color: #e74c3c; border: 2px solid #e74c3c; border-radius: 6px; font-size: 1em; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;" onmouseover="this.style.background='#ffe8e8'" onmouseout="this.style.background='#fff'">
                                <i class="fa fa-shopping-cart"></i> TH√äM V√ÄO GI·ªé
                            </button>
                        </form>
                        <form asp-controller="Cart" asp-action="Add" asp-route-id="@Model.Id" method="post" style="display: contents;" onsubmit="document.getElementById('hiddenQuantity2').value = document.getElementById('quantity').value;">
                            <input type="hidden" name="quantity" id="hiddenQuantity2" value="1" />
                            <input type="hidden" name="buyNow" value="true" />
                            <button type="submit" style="padding: 14px 20px; background: linear-gradient(135deg, #e74c3c 0%, #d63d2c 100%); color: white; border: none; border-radius: 6px; font-size: 1em; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3); display: flex; align-items: center; justify-content: center; gap: 8px;" onmouseover="this.style.boxShadow='0 6px 16px rgba(231, 76, 60, 0.4)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 4px 12px rgba(231, 76, 60, 0.3)'; this.style.transform='translateY(0)'">
                                <i class="fa fa-bolt"></i> MUA NGAY
                            </button>
                        </form>
                    }
                    else
                    {
                        <button style="padding: 14px 20px; background: #e8e8e8; color: #ccc; border: none; border-radius: 6px; font-size: 1em; font-weight: 700; cursor: not-allowed; grid-column: 1/-1;">
                            H·∫æT H√ÄNG
                        </button>
                    }
                </div>

                <!-- Social Share -->
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #efefef; display: flex; align-items: center; gap: 15px;">
                    <p style="color: #999; font-size: 0.85em; margin: 0; text-transform: uppercase;">Chia s·∫ª</p>
                    <ul class="social-nav model-3d-0 footer-social w3_agile_social single_page_w3ls" style="margin: 0; padding: 0; display: flex; gap: 8px;">
                        <li><a href="#" class="facebook" style="display: inline-flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 50%; background: #f0f0f0; transition: all 0.3s ease;">
                            <i class="fa fa-facebook" style="font-size: 1.2em; color: #3b5998;"></i>
                        </a></li>
                        <li><a href="#" class="twitter" style="display: inline-flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 50%; background: #f0f0f0; transition: all 0.3s ease;">
                            <i class="fa fa-twitter" style="font-size: 1.2em; color: #1da1f2;"></i>
                        </a></li>
                        <li><a href="#" class="instagram" style="display: inline-flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 50%; background: #f0f0f0; transition: all 0.3s ease;">
                            <i class="fa fa-instagram" style="font-size: 1.2em; color: #e1306c;"></i>
                        </a></li>
                        <li><a href="#" class="pinterest" style="display: inline-flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 50%; background: #f0f0f0; transition: all 0.3s ease;">
                            <i class="fa fa-linkedin" style="font-size: 1.2em; color: #0a66c2;"></i>
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="clearfix"></div>

        <!-- Product Tabs -->
        <div class="responsive_tabs_agileits">
            <div id="horizontalTab">
                <ul class="resp-tabs-list">
                    <li>M√¥ t·∫£</li>
                    <li>Th√¥ng tin</li>
                </ul>
                <div class="resp-tabs-container">
                    <!-- Tab 1: Description -->
                    <div class="tab1">
                        <div class="single_page_agile_its_w3ls">
                            <h6>@Model.Name</h6>
                            <p>@Model.Description</p>
                            @if (!string.IsNullOrEmpty(Model.Description))
                            {
                                <p class="w3ls_para">S·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng cao, ƒë∆∞·ª£c ki·ªÉm ƒë·ªãnh k·ªπ l∆∞·ª°ng tr∆∞·ªõc khi giao ƒë·∫øn tay kh√°ch h√†ng. ƒê·∫£m b·∫£o gi√° t·ªët nh·∫•t th·ªã tr∆∞·ªùng.</p>
                            }
                        </div>
                    </div>

                    <!-- Tab 2: Information -->
                    <div class="tab2">
                        <div class="single_page_agile_its_w3ls">
                            <h6>Th√¥ng tin s·∫£n ph·∫©m</h6>
                            <ul style="list-style: disc; padding-left: 20px;">
                                <li>T√™n s·∫£n ph·∫©m: <strong>@Model.Name</strong></li>
                                <li>Danh m·ª•c: <strong>@Model.Category</strong></li>
                                <li>Gi√°: <strong>@Model.Price.ToString("N0") ‚Ç´</strong></li>
                                <li>T·ªìn kho: <strong>@(Model.IsAvailable ? $"{Model.Stock} s·∫£n ph·∫©m" : "H·∫øt h√†ng")</strong></li>
                                <li>Tr·∫°ng th√°i: <strong>@(Model.IsAvailable ? "C√≤n h√†ng" : "H·∫øt h√†ng")</strong></li>
                                <li>B·∫£o h√†nh: 12 th√°ng</li>
                                <li>Giao h√†ng: To√†n qu·ªëc</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/imagezoom.js"></script>
    <script src="~/js/jquery.flexslider.js"></script>
    <script src="~/js/easy-responsive-tabs.js"></script>
    <script>
        $(document).ready(function () {
            // FlexSlider for product images
            $(window).load(function() {
                $('.flexslider').flexslider({
                    animation: "slide",
                    controlNav: false,
                    directionNav: true
                });
            });

            // Responsive Tabs
            $('#horizontalTab').easyResponsiveTabs({
                type: 'default',
                width: 'auto',
                fit: true,
                closed: 'accordion',
                activate: function(event) {
                    var $tab = $(this);
                    var $info = $('#tabInfo');
                    var $name = $('span', $info);
                    $name.text($tab.text());
                    $info.show();
                }
            });

            // Quantity input validation
            $('#quantity').on('change', function() {
                var val = parseInt($(this).val()) || 1;
                var max = parseInt($(this).attr('max'));
                if (val < 1) $(this).val(1);
                if (val > max) $(this).val(max);
                
                // Update hidden quantity fields
                document.getElementById('hiddenQuantity').value = val;
                document.getElementById('hiddenQuantity2').value = val;
            });

            // Update hidden quantity when using +/- buttons
            document.addEventListener('click', function(e) {
                if (e.target.closest('button[onclick*="quantity"]')) {
                    setTimeout(function() {
                        var quantity = document.getElementById('quantity').value;
                        document.getElementById('hiddenQuantity').value = quantity;
                        document.getElementById('hiddenQuantity2').value = quantity;
                    }, 10);
                }
            });
        });
        var sold = Math.floor(Math.random() * (2000 - 50 + 1)) + 50;

// Format d·∫°ng 1.2k n·∫øu mu·ªën
function formatSold(num) {
    if (num >= 1000) {
        return (num / 1000).toFixed(1) + "k";
    }
    return num;
}

document.getElementById("sold-num").textContent = formatSold(sold);
    </script>
}

<!-- Ph·∫ßn C√≥ th·ªÉ b·∫°n s·∫Ω th√≠ch -->
@{
    var relatedProducts = ViewBag.RelatedProducts as List<ShopOnlineCore.Models.Product>;
}

@if (relatedProducts != null && relatedProducts.Any())
{
    <div style="background-color: #f8f9fa; padding: 40px 0; margin-top: 60px;">
        <div class="container">
            <h3 style="text-align: center; margin-bottom: 30px; font-weight: 700;">
                üí° C√≥ th·ªÉ b·∫°n s·∫Ω th√≠ch
            </h3>

            <div class="row">
                @foreach (var product in relatedProducts)
                {
                    <div class="col-md-3 col-sm-6 col-xs-12" style="margin-bottom: 30px; display: flex;">
                            <partial name="_ProductCard" model="product" />
                    </div>
                }
            </div>
        </div>
    </div>
}
